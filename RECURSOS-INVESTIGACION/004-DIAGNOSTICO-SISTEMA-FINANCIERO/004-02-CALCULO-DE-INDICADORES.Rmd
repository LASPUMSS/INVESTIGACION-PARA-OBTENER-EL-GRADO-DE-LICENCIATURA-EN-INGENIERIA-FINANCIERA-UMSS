---
output: pdf_document
---

```{r}
source('RECURSOS-INVESTIGACION/R/camel-get-datCamelIndicadores.R')
source('RECURSOS-INVESTIGACION/R/camel-getListStatsIndicadores.R')
source('RECURSOS-INVESTIGACION/R/camel-getListPlotsIndicadores.R')
source('RECURSOS-INVESTIGACION/R/camel-get-datIdsNamesCamelInds.R')
source("RECURSOS-INVESTIGACION/R/camel-render-tables-indicadoresStats.R")
source("RECURSOS-INVESTIGACION/R/render-table-basic.R")
source("RECURSOS-INVESTIGACION/R/handles.R")

require(dplyr)
require(stringr)
require(glue)
require(ggplot2)
require(patchwork)
require(knitr)
require(kableExtra)

if (!('dat' %in% ls())) {dat <- NULL}

datCamelIndNorm <- getDatCamelIndicadores(dat=dat, by='TIPO_DE_ENTIDAD')
datIdsNamesCamelInds <- getDatIdsNamesCamelIndicadores()

```


## Calculo de indicadores

En la presente sección se tiene por objeto presentar los indicadores que evaluaran las diferentes características de los sectores financieros que harán manifiesto si dicho sector tiene la capacidad de hacer frente a sus obligaciones.

### Indicadores de capital

<!-- ##################################################### -->
<!-- #####################  INDICADORES DE CAPITAL         -->
<!-- ##################################################### -->

```{r}
ids <- c('indCap_CAP','indCap_CCCM','indCap_CACCM','indCap_CCP')
listResult <- getListStatsOverviewInd(ids, datCamelIndNorm, datIdsNamesCamelInds)
listPlots <- getListPlotsInd(listResult)
listTablesRender <- renderListTablesInd(listResult, 'Tendencia y estadisticas de indicadores de capital', 6)

```

Los indicadores de capital buscan responder o evaluar la capacidad del capital de los sectores financieros para hacer frente a sus obligaciones con terceros y propios, a continuación se presentan los indicadores de capital:

```{r, fig.height = 20, fig.width = 20, fig.cap='Indicadores de capital'}
wrap_plots(listPlots, ncol = 1)
```

```{r}
listTablesRender %>% 
    footnote(general_title = 'NOTA:',
                              general = 'Los sectores en la tabla fueron ordenados en función del más al menos favorable dado su indicador promedio.')
```


#### Coeficiente de adecuación patrimonial (CAP)

```{r}
id <- 'indCap_CAP'
nameIndById <- listResult[[id]][['nameIndById']]
nameEntBestPromedio <- listResult[[id]][['nameEntBestPromedio']]
bestPromedio <- listResult[[id]][['bestPromedio']]

```

El promedio mas favorable en el `r str_to_lower(nameIndById)` a través del tiempo esta dado en el sector de `r str_to_lower(nameEntBestPromedio)` con un promedio de `r format(bestPromedio, scientific=FALSE)`.

#### Coeficiente de cobertura de cartera en mora (CCCM)

```{r}
id <- 'indCap_CCCM'
nameIndById <- listResult[[id]][['nameIndById']]
nameEntBestPromedio <- listResult[[id]][['nameEntBestPromedio']]
bestPromedio <- listResult[[id]][['bestPromedio']]

```

El indicador esta definido por la siguiente ecuación:

$$ \frac{ \text{Cartera En Mora - Previsión Cartera} }{\text{Patrimonio}}$$

El mejor resultado para este indicador esta dado por aquel que sea lo mas bajo posible lo cual mostraría que el patrimonio del sector puede cubrir en su totalidad la cartera en mora, donde la tabla da como promedio mas favorable en el `r str_to_lower(nameIndById)` a través del tiempo esta dado en el sector de `r str_to_lower(nameEntBestPromedio)` con un promedio de `r format(bestPromedio, scientific=FALSE)`, ahora bien el hecho que los promedios para los diferentes sectores sea negativo indica que los mismos hacen una previsión superior a la cartera en mora lo cual es favorable para su solidez financiera, así también el promedio de sus indicadores se menores a 1 indica que el patrimonio puede hacer frente las obligaciones que se puedan generar por cubrir la cartera en mora.


#### Coeficiente acido de cobertura de cartera en mora (CACCM)

```{r}
id <- 'indCap_CACCM'
nameIndById <- listResult[[id]][['nameIndById']]
nameEntBestPromedio <- listResult[[id]][['nameEntBestPromedio']]
bestPromedio <- listResult[[id]][['bestPromedio']]

```

El indicador esta definido por la siguiente ecuación:

$$ \frac{ \text{Cartera En Mora - Previsión Cartera + Realizables} }{ \text{Patrimonio} } $$

El promedio mas favorable en el `r str_to_lower(nameIndById)` a través del tiempo esta dado en el sector de `r str_to_lower(nameEntBestPromedio)` con un promedio de `r format(bestPromedio, scientific=FALSE)`, una vez mas se hace presente que la previsión cubre la cartera en mora mas realizables que vienen siendo en mayoría activos producto de la recuperación de créditos incumplidos con la entidad.

#### Coeficiente de cobertura patrimonial (CCP)

```{r}
id <- 'indCap_CCP'
nameIndById <- listResult[[id]][['nameIndById']]
nameEntBestPromedio <- listResult[[id]][['nameEntBestPromedio']]
bestPromedio <- listResult[[id]][['bestPromedio']]

```


El indicador esta definido por la siguiente ecuación:

$$ \frac{ \text{Patrimonio} }{ \text{Activo - Contingente} } $$

El promedio mas favorable en el `r str_to_lower(nameIndById)` a través del tiempo esta dado en el sector de `r str_to_lower(nameEntBestPromedio)` con un promedio de `r format(bestPromedio, scientific=FALSE)`.


\newpage
### Indicadores de activos

<!-- ##################################################### -->
<!-- #####################  INDICADORES DE ACTIVOS         -->
<!-- ##################################################### -->

Los indicadores de activos tienen por objeto de evaluar la capacidad de los activos de los respectivos sectores financieros para hacer frente a sus obligaciones, a continuación se presentan los indicadores de activos:

```{r}
ids <- c('indAct_CEC','indAct_CPC','indAct_CPCM','indAct_CRC')
listResult <- getListStatsOverviewInd(ids, datCamelIndNorm, datIdsNamesCamelInds)
listPlots <- getListPlotsInd(listResult)
listTablesRender <- renderListTablesInd(listResult, 'Tendencia y estadisticas de indicadores de activos', 6)

```

```{r, fig.height = 20, fig.width = 20, fig.cap='Indicadores de activos'}
wrap_plots(listPlots, ncol = 1)
```

```{r}
listTablesRender %>% 
    footnote(general_title = 'NOTA:',
                              general = 'Los sectores en la tabla fueron ordenados en función del más al menos favorable dado su indicador promedio.')
```

#### Coeficiente de exposición de cartera (CEC)

```{r}
id <- 'indAct_CEC'
nameIndById <- listResult[[id]][['nameIndById']]
nameEntBestPromedio <- listResult[[id]][['nameEntBestPromedio']]
bestPromedio <- listResult[[id]][['bestPromedio']]

```

El indicador busca mostrar en que nivel de la cartera total o bruta esta expuesta a impago, dicho indicador esta definido por la siguiente ecuación:

$$  \frac{ \text{Cartera En Mora} }{ \text{Cartera Bruta} } $$

Donde el promedio mas favorable en el `r str_to_lower(nameIndById)` a través del tiempo esta dado en el sector de `r str_to_lower(nameEntBestPromedio)` con un promedio de `r format(bestPromedio, scientific=FALSE)`, es decir, que el `r format(round(bestPromedio*100,2), scientific=FALSE)`% de la cartera bruta o total tiene riesgo de impago siendo este menor respecto a los de los otros sectores.

#### Coeficiente de previsión de cartera (CPC)

```{r}
id <- 'indAct_CPC'
nameIndById <- listResult[[id]][['nameIndById']]
nameEntBestPromedio <- listResult[[id]][['nameEntBestPromedio']]
bestPromedio <- listResult[[id]][['bestPromedio']]

```

El indicador busca mostrar el porcentaje de la cartera total o bruta se susceptible de impago, dicho indicador esta definido por la siguiente ecuación:

$$ \frac{ \text{Previsión} }{ \text{Cartera Bruta} } $$ 

Donde el promedio mas favorable en el `r str_to_lower(nameIndById)` a través del tiempo esta dado en el sector de `r str_to_lower(nameEntBestPromedio)` con un promedio de `r format(bestPromedio, scientific=FALSE)`, es decir, el sector supone que el `r format(round(bestPromedio*100,2), scientific=FALSE)`% de la cartera bruta o total sera sujeto de impago.

#### Coeficiente de previsión de cartera en mora (CPCM)

```{r}
id <- 'indAct_CPCM'
nameIndById <- listResult[[id]][['nameIndById']]
nameEntBestPromedio <- listResult[[id]][['nameEntBestPromedio']]
bestPromedio <- listResult[[id]][['bestPromedio']]

```

El indicador esta definido por la siguiente ecuación:

$$ \frac{ \text{Previsión} }{ \text{Cartera En Mora} } $$

El promedio mas favorable en el `r str_to_lower(nameIndById)` a través del tiempo esta dado en el sector de `r str_to_lower(nameEntBestPromedio)` con un promedio de `r format(bestPromedio, scientific=FALSE)`.

#### Coeficiente de reposición de cartera (CRC)

```{r}
id <- 'indAct_CRC'
nameIndById <- listResult[[id]][['nameIndById']]
nameEntBestPromedio <- listResult[[id]][['nameEntBestPromedio']]
bestPromedio <- listResult[[id]][['bestPromedio']]

```

El indicador muestra que porcentaje de la cartera total fueron reprogramados, dicho indicador esta definido por la siguiente ecuación:

$$ \frac{ \text{Cartera Reprogramada Total} }{ \text{Cartera Bruta} } $$

Donde el promedio mas favorable en el `r str_to_lower(nameIndById)` a través del tiempo esta dado en el sector de `r str_to_lower(nameEntBestPromedio)` con un promedio de `r format(bestPromedio, scientific=FALSE)`, es decir, el `r format(round(bestPromedio*100,2), scientific=FALSE)`% de la cartera bruta o total es sujeta a reprogramación, tomando en cuenta que dicho promedio sufre un sesgo fruto por la pandemia covid-19 que dio que un incremento considerado la reprogramación de cartera en las gestiones 2020 y 2021.

\newpage
### Indicadores de administración

<!-- ##################################################### -->
<!-- ###############  INDICADORES DE ADMINISTRACION        -->
<!-- ##################################################### -->

Los indicadores de administración tienen por objeto evaluar como las instituciones gestionan sus gastos administrativos, los cuales se presenta a continuación:

```{r}
ids <- c('indAdm_CCGA','indAdm_CACGA')
listResult <- getListStatsOverviewInd(ids, datCamelIndNorm, datIdsNamesCamelInds)
listPlots <- getListPlotsInd(listResult)
listTablesRender <- renderListTablesInd(listResult, 'Tendencia y estadisticas de indicadores de administración', 6)

```

```{r, fig.height = 20, fig.width = 20, fig.cap='Indicadores de administración'}
wrap_plots(listPlots, ncol = 1)
```

```{r}
listTablesRender %>% 
    footnote(general_title = 'NOTA:',
                              general = 'Los sectores en la tabla fueron ordenados en función del más al menos favorable dado su indicador promedio.')
```

#### Coeficiente de cobertura gastos administrativos (CCGA)

```{r}
id <- 'indAdm_CCGA'
nameIndById <- listResult[[id]][['nameIndById']]
nameEntBestPromedio <- listResult[[id]][['nameEntBestPromedio']]
bestPromedio <- listResult[[id]][['bestPromedio']]

```

El indicador esta definido por la siguiente ecuación:

$$ \frac{ \text{Gastos Administración} }{ \text{Activos + Contingentes} } $$ 

El promedio mas favorable en el `r str_to_lower(nameIndById)` a través del tiempo esta dado en el sector de `r str_to_lower(nameEntBestPromedio)` con un promedio de `r format(bestPromedio, scientific=FALSE)`.

#### Coeficiente acido de cobertura gastos administrativos (CACGA)

```{r}
id <- 'indAdm_CACGA'
nameIndById <- listResult[[id]][['nameIndById']]
nameEntBestPromedio <- listResult[[id]][['nameEntBestPromedio']]
bestPromedio <- listResult[[id]][['bestPromedio']]

```

El indicador esta definido por la siguiente ecuación:

$$ \frac{ \text{Gastos Administración - Impuestos} }{ \text{Resultado Operativo Bruto} } $$

El promedio mas favorable en el `r str_to_lower(nameIndById)` a través del tiempo esta dado en el sector de `r str_to_lower(nameEntBestPromedio)` con un promedio de `r format(bestPromedio, scientific=FALSE)`.

\newpage
### Indicadores de beneficios

<!-- ##################################################### -->
<!-- ###############  INDICADORES DE BENEFICIOS       -->
<!-- ##################################################### -->

Los indicadores de beneficios tienen por objeto de evaluar la capacidad de los beneficios de las instituciones para hacer frente a sus obligaciones con terceros, a continuación se presentan los indicadores de beneficios:

```{r}
ids <- c('indBenf_ROA','indBenf_ROE')
listResult <- getListStatsOverviewInd(ids, datCamelIndNorm, datIdsNamesCamelInds)
listPlots <- getListPlotsInd(listResult)
listTablesRender <- renderListTablesInd(listResult, 'Tendencia y estadisticas de indicadores de beneficios', 6)

```

```{r, fig.height = 20, fig.width = 20, fig.cap='Indicadores de beneficios'}
wrap_plots(listPlots, ncol = 1)
```

```{r}
listTablesRender %>% 
    footnote(general_title = 'NOTA:',
                              general = 'Los sectores en la tabla fueron ordenados en función del más al menos favorable dado su indicador promedio.')
```

#### Coeficiente de rendimiento sobre activos (ROA)

```{r}
id <- 'indBenf_ROA'
nameIndById <- listResult[[id]][['nameIndById']]
nameEntBestPromedio <- listResult[[id]][['nameEntBestPromedio']]
bestPromedio <- listResult[[id]][['bestPromedio']]

```

El indicador esta definido por la siguiente ecuación:

$$ \frac{ \text{Resultado Neto De La Gestión} }{ \text{Activo+Contingente} } $$

El promedio mas favorable en el `r str_to_lower(nameIndById)` a través del tiempo esta dado en el sector de `r str_to_lower(nameEntBestPromedio)` con un promedio de `r format(bestPromedio, scientific=FALSE)`.

#### Coeficiente de rendimiento sobre patrimonio (ROE)

```{r}
id <- 'indBenf_ROE'
nameIndById <- listResult[[id]][['nameIndById']]
nameEntBestPromedio <- listResult[[id]][['nameEntBestPromedio']]
bestPromedio <- listResult[[id]][['bestPromedio']]

```

El indicador esta definido por la siguiente ecuación:

$$ \frac{ \text{Resultado Neto De La Gestión} }{ \text{Patrimonio} } $$

El promedio mas favorable en el `r str_to_lower(nameIndById)` a través del tiempo esta dado en el sector de `r str_to_lower(nameEntBestPromedio)` con un promedio de `r format(bestPromedio, scientific=FALSE)`.

Es decir, que el sector de `r str_to_lower(nameEntBestPromedio)` puede generar un rendimiento promedio mensual de `r format(round(bestPromedio*100,2), scientific=FALSE)` sobre el patrimonio.

\newpage
### Indicadores de liquidez

<!-- ##################################################### -->
<!-- ###############  INDICADORES DE BENEFICIOS            -->
<!-- ##################################################### -->

Los indicadores de liquidez tienen por objeto de evaluar la capacidad de las instituciones para hacer frente a sus obligaciones con terceros con sus activos mas líquidos, a continuación se presentan los indicadores de liquidez:

```{r}
ids <- c('indLq_CCPP','indLq_CACPP')
listResult <- getListStatsOverviewInd(ids, datCamelIndNorm, datIdsNamesCamelInds)
listPlots <- getListPlotsInd(listResult)
listTablesRender <- renderListTablesInd(listResult, 'Tendencia y estadisticas de indicadores de liquidez', 6)

```

```{r, fig.height = 20, fig.width = 20, fig.cap='Indicadores de liquidez'}
wrap_plots(listPlots, ncol = 1)
```

```{r}
listTablesRender %>% 
    footnote(general_title = 'NOTA:',
                              general = 'Los sectores en la tabla fueron ordenados en función del más al menos favorable dado su indicador promedio.')
```

####  Coeficiente de capacidad de pago frente a pasivos (CCPP)

```{r}
id <- 'indLq_CCPP'
nameIndById <- listResult[[id]][['nameIndById']]
nameEntBestPromedio <- listResult[[id]][['nameEntBestPromedio']]
bestPromedio <- listResult[[id]][['bestPromedio']]

```

El indicador esta definido por la siguiente ecuación:

$$ \frac{ \text{Disponibles + Inversiones Temporarias} }{ \text{Pasivos} } $$

El promedio mas favorable en el `r str_to_lower(nameIndById)` a través del tiempo esta dado en el sector de `r str_to_lower(nameEntBestPromedio)` con un promedio de `r format(bestPromedio, scientific=FALSE)`.

Es decir, el sector de `r str_to_lower(nameEntBestPromedio)` puede hacer frente a sus obligaciones con terceros en menos de 30 días hasta un  `r format(round(bestPromedio*100,2), scientific=FALSE)`% de su totalidad.

#### Coeficiente acido de capacidad de pago frente a pasivos (CACPP)

```{r}
id <- 'indLq_CACPP'
nameIndById <- listResult[[id]][['nameIndById']]
nameEntBestPromedio <- listResult[[id]][['nameEntBestPromedio']]
bestPromedio <- listResult[[id]][['bestPromedio']]

```

El indicador esta definido por la siguiente ecuación:

$$ \frac{ \text{Disponibles} }{ \text{Pasivos} } $$

El promedio mas favorable en el `r str_to_lower(nameIndById)` a través del tiempo esta dado en el sector de `r str_to_lower(nameEntBestPromedio)` con un promedio de `r format(bestPromedio, scientific=FALSE)`.

Es decir, el sector de `r str_to_lower(nameEntBestPromedio)` puede hacer frente a sus obligaciones con terceros de manera con sus activos mas líquidos de disposición inmediata hasta un  `r format(round(bestPromedio*100,2), scientific=FALSE)`% del total de las obligaciones con terceros.



