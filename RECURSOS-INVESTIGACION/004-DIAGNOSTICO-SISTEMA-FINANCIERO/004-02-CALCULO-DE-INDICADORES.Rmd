```{r}
source('RECURSOS-INVESTIGACION/R/camel-get-datCamelIndicadores.R')
source('RECURSOS-INVESTIGACION/R/camel-getListStatsIndicadores.R')
source('RECURSOS-INVESTIGACION/R/camel-getListPlotsIndicadores.R')
source('RECURSOS-INVESTIGACION/R/camel-get-datIdsNamesCamelInds.R')
source("RECURSOS-INVESTIGACION/R/camel-render-tables-indicadoresStats.R")
source("RECURSOS-INVESTIGACION/R/render-table-basic.R")
source("RECURSOS-INVESTIGACION/R/handles.R")

require(dplyr)
require(stringr)
require(glue)
require(ggplot2)
require(patchwork)
require(knitr)
require(kableExtra)

if (!('dat' %in% ls())) {dat <- NULL}

datCamelIndNorm <- getDatCamelIndicadores(dat=dat, by='TIPO_DE_ENTIDAD')
datIdsNamesCamelInds <- getDatIdsNamesCamelIndicadores()

```


## Calculo de indicadores

En la presente sección se tiene por objeto presentar los indicadores que evaluaran las diferentes características de los sectores financieros que harán manifiesto si dicho sector tiene la capacidad de hacer frente a sus obligaciones.

### Indicadores de capital

<!-- ##################################################### -->
<!-- #####################  INDICADORES DE CAPITAL         -->
<!-- ##################################################### -->

```{r}
ids <- c('indCap_CAP','indCap_CCCM','indCap_CACCM','indCap_CCP')
listResult <- getListStatsOverviewInd(ids, datCamelIndNorm, datIdsNamesCamelInds)
listPlots <- getListPlotsInd(listResult)
listTablesRender <- renderListTablesInd(listResult, 'Tendencia y estadisticas de indicadores de capital', 6)

```

Los indicadores de capital buscan responder o evaluar la capacidad del capital contable de los sectores financieros para hacer frente a sus obligaciones con terceros y propios, a continuación se presentan los resultados de los mismos:

```{r, fig.height = 20, fig.width = 20, fig.cap='Indicadores de capital'}
wrap_plots(listPlots, ncol = 1)
```

```{r}
listTablesRender %>% 
    footnote(general_title = 'NOTA:',
                              general = 'Los sectores en la tabla fueron ordenados en función del más al menos favorable dado su indicador promedio.')
```


#### Coeficiente de adecuación patrimonial (CAP)

```{r}
id <- 'indCap_CAP'
nameIndById <- listResult[[id]][['nameIndById']]
nameEntBestPromedio <- listResult[[id]][['nameEntBestPromedio']]
bestPromedio <- listResult[[id]][['bestPromedio']]

```

El promedio mas favorable en el `r str_to_lower(nameIndById)` a través del tiempo esta dado en el sector de `r str_to_lower(nameEntBestPromedio)` con un promedio de `r format(round(bestPromedio*100,2), scientific=FALSE)`%, lo cual indica que el capital regulatorio de las `r str_to_lower(nameEntBestPromedio)` cubre en promedio el `r format(round(bestPromedio*100,2), scientific=FALSE)`% de los activos y contingentes ponderados en función de factores de riesgo.

#### Coeficiente de cobertura de cartera en mora (CCCM)

```{r}
id <- 'indCap_CCCM'
nameIndById <- listResult[[id]][['nameIndById']]
nameEntBestPromedio <- listResult[[id]][['nameEntBestPromedio']]
bestPromedio <- listResult[[id]][['bestPromedio']]

```

El indicador esta definido por la siguiente ecuación:

$$ \frac{ \text{Cartera En Mora - Previsión Cartera} }{\text{Patrimonio}}$$

El mejor resultado para este indicador esta dado por aquel que sea lo mas bajo posible lo cual mostraría que el patrimonio del sector puede cubrir en su totalidad la cartera en mora, donde la tabla da como promedio mas favorable en el `r str_to_lower(nameIndById)` a través del tiempo esta dado en el sector de `r str_to_lower(nameEntBestPromedio)` con un promedio de `r format(bestPromedio, scientific=FALSE)`, ahora bien el hecho que los promedios para los diferentes sectores sea negativo indica que los mismos hacen una previsión superior a la cartera en mora lo cual es favorable para su solidez financiera, así también el promedio de sus indicadores se menores a 1 indica que el patrimonio puede hacer frente las obligaciones que se puedan generar por cubrir la cartera en mora.


#### Coeficiente acido de cobertura de cartera en mora (CACCM)

```{r}
id <- 'indCap_CACCM'
nameIndById <- listResult[[id]][['nameIndById']]
nameEntBestPromedio <- listResult[[id]][['nameEntBestPromedio']]
bestPromedio <- listResult[[id]][['bestPromedio']]

```

El indicador esta definido por la siguiente ecuación:

$$ \frac{ \text{Cartera En Mora - Previsión Cartera + Realizables} }{ \text{Patrimonio} } $$

El promedio mas favorable en el `r str_to_lower(nameIndById)` a través del tiempo esta dado en el sector de `r str_to_lower(nameEntBestPromedio)` con un promedio de `r format(bestPromedio, scientific=FALSE)`, una vez mas se hace presente que la previsión cubre la cartera en mora mas realizables que vienen siendo en mayoría activos producto de la recuperación de créditos incumplidos con la entidad.

#### Coeficiente de cobertura patrimonial (CCP)

```{r}
id <- 'indCap_CCP'
nameIndById <- listResult[[id]][['nameIndById']]
nameEntBestPromedio <- listResult[[id]][['nameEntBestPromedio']]
bestPromedio <- listResult[[id]][['bestPromedio']]

```


El indicador esta definido por la siguiente ecuación:

$$ \frac{ \text{Patrimonio} }{ \text{Activo - Contingente} } $$

El promedio mas favorable en el `r str_to_lower(nameIndById)` a través del tiempo esta dado en el sector de `r str_to_lower(nameEntBestPromedio)` con un promedio de `r format(bestPromedio, scientific=FALSE)`.


\newpage
### Indicadores de activos

<!-- ##################################################### -->
<!-- #####################  INDICADORES DE ACTIVOS         -->
<!-- ##################################################### -->

Los indicadores de activos tienen por objeto de evaluar la composición de los activos de los respectivos sectores financieros los cuales junto al patrimonio permiten hacer frente a sus obligaciones, los cuales son los siguientes:

```{r}
ids <- c('indAct_CEC','indAct_CPC','indAct_CPCM','indAct_CRC')
listResult <- getListStatsOverviewInd(ids, datCamelIndNorm, datIdsNamesCamelInds)
listPlots <- getListPlotsInd(listResult)
listTablesRender <- renderListTablesInd(listResult, 'Tendencia y estadisticas de indicadores de activos', 6)

```

```{r, fig.height = 20, fig.width = 20, fig.cap='Indicadores de activos'}
wrap_plots(listPlots, ncol = 1)
```

```{r}
listTablesRender %>% 
    footnote(general_title = 'NOTA:',
                              general = 'Los sectores en la tabla fueron ordenados en función del más al menos favorable dado su indicador promedio.')
```

#### Coeficiente de exposición de cartera (CEC)

```{r}
id <- 'indAct_CEC'
nameIndById <- listResult[[id]][['nameIndById']]
nameEntBestPromedio <- listResult[[id]][['nameEntBestPromedio']]
bestPromedio <- listResult[[id]][['bestPromedio']]

```

El indicador busca mostrar en que proporción la cartera total o bruta esta expuesta a impago, dicho indicador esta definido por la siguiente ecuación:

$$  \frac{ \text{Cartera En Mora} }{ \text{Cartera Bruta} } $$

Donde el promedio mas favorable en el `r str_to_lower(nameIndById)` a través del tiempo esta dado en el sector de `r str_to_lower(nameEntBestPromedio)` con un promedio de `r format(bestPromedio, scientific=FALSE)`, es decir, que el `r format(round(bestPromedio*100,2), scientific=FALSE)`% de la cartera bruta o total tiene riesgo de impago siendo este menor respecto a los otros sectores.

#### Coeficiente de previsión de cartera (CPC)

```{r}
id <- 'indAct_CPC'
nameIndById <- listResult[[id]][['nameIndById']]
nameEntBestPromedio <- listResult[[id]][['nameEntBestPromedio']]
bestPromedio <- listResult[[id]][['bestPromedio']]

```

El indicador busca mostrar en que proporción la cartera total o bruta podría ser susceptible de impago bajo el criterio de prevención, dicho indicador esta definido por la siguiente ecuación:

$$ \frac{ \text{Previsión} }{ \text{Cartera Bruta} } $$ 

Donde el promedio mas favorable en el `r str_to_lower(nameIndById)` a través del tiempo esta dado en el sector de `r str_to_lower(nameEntBestPromedio)` con un promedio de `r format(bestPromedio, scientific=FALSE)`, es decir, el sector supone que el `r format(round(bestPromedio*100,2), scientific=FALSE)`% de la cartera bruta o total sera sujeto de impago, teniendo en cuenta que dicho indicador sera tomado como valido si y solo si la prevención sea menor al impago efectivamente observado.

#### Coeficiente de previsión de cartera en mora (CPCM)

```{r}
id <- 'indAct_CPCM'
nameIndById <- listResult[[id]][['nameIndById']]
nameEntBestPromedio <- listResult[[id]][['nameEntBestPromedio']]
bestPromedio <- listResult[[id]][['bestPromedio']]

```

El indicador tiene por objeto mostrar si las previsiones realizadas por los sectores llegan a cubrir en su totalidad la cartera en mora que son susceptibles a impago, dicho indicador esta definido por la siguiente ecuación:

$$ \frac{ \text{Previsión} }{ \text{Cartera En Mora} } $$

El promedio mas favorable en el `r str_to_lower(nameIndById)` a través del tiempo esta dado en el sector de `r str_to_lower(nameEntBestPromedio)` con un promedio de `r format(bestPromedio, scientific=FALSE)`, es decir, que el sector de `r str_to_lower(nameEntBestPromedio)` realiza un previsión que cubre hasta en `r format(round(bestPromedio,0), scientific=FALSE)` la cartera en mora, teniendo en cuenta que el resultado del indicador puede ser considerarse como favorable cuando este supera a 1.

#### Coeficiente de reposición de cartera (CRC)

```{r}
id <- 'indAct_CRC'
nameIndById <- listResult[[id]][['nameIndById']]
nameEntBestPromedio <- listResult[[id]][['nameEntBestPromedio']]
bestPromedio <- listResult[[id]][['bestPromedio']]

```

El indicador muestra que porcentaje de la cartera total fueron reprogramados, dicho indicador esta definido por la siguiente ecuación:

$$ \frac{ \text{Cartera Reprogramada Total} }{ \text{Cartera Bruta} } $$

Donde el promedio mas favorable en el `r str_to_lower(nameIndById)` a través del tiempo esta dado en el sector de `r str_to_lower(nameEntBestPromedio)` con un promedio de `r format(bestPromedio, scientific=FALSE)`, es decir, el `r format(round(bestPromedio*100,2), scientific=FALSE)`% de la cartera bruta o total es sujeta a reprogramación, tomando en cuenta que dicho promedio sufre un sesgo fruto por la pandemia covid-19 que produjo un incremento considerado en la reprogramación de cartera en las gestiones 2020 y 2021.


### Indicadores de administración

<!-- ##################################################### -->
<!-- ###############  INDICADORES DE ADMINISTRACION        -->
<!-- ##################################################### -->

Los indicadores de administración tienen por objeto evaluar como las instituciones gestionan sus gastos administrativos, los cuales se presenta a continuación:

```{r}
ids <- c('indAdm_CCGA','indAdm_CACGA')
listResult <- getListStatsOverviewInd(ids, datCamelIndNorm, datIdsNamesCamelInds)
listPlots <- getListPlotsInd(listResult)
listTablesRender <- renderListTablesInd(listResult, 'Tendencia y estadisticas de indicadores de administración', 6)

```

```{r, fig.height = 20, fig.width = 20, fig.cap='Indicadores de administración'}
wrap_plots(listPlots, ncol = 1)
```

```{r}
listTablesRender %>% 
    footnote(general_title = 'NOTA:',
                              general = 'Los sectores en la tabla fueron ordenados en función del más al menos favorable dado su indicador promedio.')
```

#### Coeficiente de cobertura gastos administrativos (CCGA)

```{r}
id <- 'indAdm_CCGA'
nameIndById <- listResult[[id]][['nameIndById']]
nameEntBestPromedio <- listResult[[id]][['nameEntBestPromedio']]
bestPromedio <- listResult[[id]][['bestPromedio']]

```

El indicador busca mostrar la representación de los gastos administrativos respecto a los activos mas contingentes, dicho indicador esta definido por la siguiente ecuación:

$$ \frac{ \text{Gastos Administración} }{ \text{Activos + Contingentes} } $$ 

Donde el promedio mas favorable en el `r str_to_lower(nameIndById)` a través del tiempo esta dado en el sector de `r str_to_lower(nameEntBestPromedio)` con un promedio de `r format(bestPromedio, scientific=FALSE)`, teniendo la consideración que la tendencia de dicho indicador del sector es positiva que de mantenerse en el largo plazo mostraría una mala gestión de los gastos administrativos.

#### Coeficiente acido de cobertura gastos administrativos (CACGA)

```{r}
id <- 'indAdm_CACGA'
nameIndById <- listResult[[id]][['nameIndById']]
nameEntBestPromedio <- listResult[[id]][['nameEntBestPromedio']]
bestPromedio <- listResult[[id]][['bestPromedio']]

```

El indicador busca mostrar si los gastos administrativos menos impuestos se encuentran contenidos por el resultado operativo bruto, dicho indicador esta definido por la siguiente ecuación:

$$ \frac{ \text{Gastos Administración - Impuestos} }{ \text{Resultado Operativo Bruto} } $$

Dando lugar al promedio mas favorable en el `r str_to_lower(nameIndById)` a través del tiempo, esta dado en el sector de `r str_to_lower(nameEntBestPromedio)` con un promedio de `r format(bestPromedio, scientific=FALSE)`, el cual ser inferior a 1 indica que los gastos adminitrativos menos impuesto se encuentran cubierto por el resultado operativo bruto.


### Indicadores de beneficios

<!-- ##################################################### -->
<!-- ###############  INDICADORES DE BENEFICIOS       -->
<!-- ##################################################### -->

Los indicadores de beneficios tienen por objeto de evaluar el rendimiento o generación de valor de las instituciones o sectores financieros, los cuales se presentan a continuación:

```{r}
ids <- c('indBenf_ROA','indBenf_ROE')
listResult <- getListStatsOverviewInd(ids, datCamelIndNorm, datIdsNamesCamelInds)
listPlots <- getListPlotsInd(listResult)
listTablesRender <- renderListTablesInd(listResult, 'Tendencia y estadisticas de indicadores de beneficios', 6)

```

```{r, fig.height = 20, fig.width = 20, fig.cap='Indicadores de beneficios'}
wrap_plots(listPlots, ncol = 1)
```

```{r}
listTablesRender %>% 
    footnote(general_title = 'NOTA:',
                              general = 'Los sectores en la tabla fueron ordenados en función del más al menos favorable dado su indicador promedio.')
```

#### Coeficiente de rendimiento sobre activos (ROA)

```{r}
id <- 'indBenf_ROA'
nameIndById <- listResult[[id]][['nameIndById']]
nameEntBestPromedio <- listResult[[id]][['nameEntBestPromedio']]
bestPromedio <- listResult[[id]][['bestPromedio']]

```

El indicador esta definido por la siguiente ecuación:

$$ \frac{ \text{Resultado Neto De La Gestión} }{ \text{Activo+Contingente} } $$

El promedio mas favorable en el `r str_to_lower(nameIndById)` a través del tiempo esta dado en el sector de `r str_to_lower(nameEntBestPromedio)` con un promedio de `r format(bestPromedio, scientific=FALSE)`, lo cual quiere decir que si consideramos al activo como elemento necesario para generar valor el sector de `r str_to_lower(nameEntBestPromedio)` pudo generar valor hasta en un `r format(round(bestPromedio*100,2), scientific=FALSE)`% mensual promedio sobre los activos.

#### Coeficiente de rendimiento sobre patrimonio (ROE)

```{r}
id <- 'indBenf_ROE'
nameIndById <- listResult[[id]][['nameIndById']]
nameEntBestPromedio <- listResult[[id]][['nameEntBestPromedio']]
bestPromedio <- listResult[[id]][['bestPromedio']]

```

El indicador esta definido por la siguiente ecuación:

$$ \frac{ \text{Resultado Neto De La Gestión} }{ \text{Patrimonio} } $$

El promedio mas favorable en el `r str_to_lower(nameIndById)` a través del tiempo esta dado en el sector de `r str_to_lower(nameEntBestPromedio)` con un promedio de `r format(bestPromedio, scientific=FALSE)`, es decir, que por cada unidad contenida en el patrimonio el sector genero o creo riqueza para sus propietarios del `r format(round(bestPromedio*100,2), scientific=FALSE)`% mensual promedio.



### Indicadores de liquidez

<!-- ##################################################### -->
<!-- ###############  INDICADORES DE BENEFICIOS            -->
<!-- ##################################################### -->

Los indicadores de liquidez tienen por objeto de evaluar la capacidad de las instituciones para hacer frente a sus obligaciones con terceros con sus activos mas líquidos, a continuación se presentan los indicadores de liquidez:

```{r}
ids <- c('indLq_CCPP','indLq_CACPP')
listResult <- getListStatsOverviewInd(ids, datCamelIndNorm, datIdsNamesCamelInds)
listPlots <- getListPlotsInd(listResult)
listTablesRender <- renderListTablesInd(listResult, 'Tendencia y estadisticas de indicadores de liquidez', 6)

```

```{r, fig.height = 20, fig.width = 20, fig.cap='Indicadores de liquidez'}
wrap_plots(listPlots, ncol = 1)
```

```{r}
listTablesRender %>% 
    footnote(general_title = 'NOTA:',
                              general = 'Los sectores en la tabla fueron ordenados en función del más al menos favorable dado su indicador promedio.')
```

####  Coeficiente de capacidad de pago frente a pasivos (CCPP)

```{r}
id <- 'indLq_CCPP'
nameIndById <- listResult[[id]][['nameIndById']]
nameEntBestPromedio <- listResult[[id]][['nameEntBestPromedio']]
bestPromedio <- listResult[[id]][['bestPromedio']]

```

El indicador esta definido por la siguiente ecuación:

$$ \frac{ \text{Disponibles + Inversiones Temporarias} }{ \text{Pasivos} } $$

El promedio mas favorable en el `r str_to_lower(nameIndById)` a través del tiempo esta dado en el sector de `r str_to_lower(nameEntBestPromedio)` con un promedio de `r format(bestPromedio, scientific=FALSE)`, es decir que el sector de `r str_to_lower(nameEntBestPromedio)` puede hacer frente a sus obligaciones con terceros en menos de 30 días hasta un  `r format(round(bestPromedio*100,2), scientific=FALSE)`% de su totalidad.

#### Coeficiente acido de capacidad de pago frente a pasivos (CACPP)

```{r}
id <- 'indLq_CACPP'
nameIndById <- listResult[[id]][['nameIndById']]
nameEntBestPromedio <- listResult[[id]][['nameEntBestPromedio']]
bestPromedio <- listResult[[id]][['bestPromedio']]

```

El indicador esta definido por la siguiente ecuación:

$$ \frac{ \text{Disponibles} }{ \text{Pasivos} } $$

El promedio mas favorable en el `r str_to_lower(nameIndById)` a través del tiempo esta dado en el sector de `r str_to_lower(nameEntBestPromedio)` con un promedio de `r format(bestPromedio, scientific=FALSE)`, que el lo mismo decir que el sector de `r str_to_lower(nameEntBestPromedio)` puede hacer frente a sus obligaciones con terceros con sus activos mas líquidos de disposición inmediata hasta un  `r format(round(bestPromedio*100,2), scientific=FALSE)`% del total de las obligaciones.



