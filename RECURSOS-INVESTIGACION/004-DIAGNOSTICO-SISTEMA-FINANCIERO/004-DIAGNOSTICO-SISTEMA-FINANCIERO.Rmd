---
output: pdf_document
---

<!-- FUNCIONES NECESARIAS -->
```{r}
source('../R/camel-plot-functions.R')
source('../R/camel-norm-getCamelInd.R')
source('../R/camel-get-datIdsNamesCamelInds.R')
source('../R/camel-limites-rangos.R')
source('../R/camel-render-table-rangos-limites.R')
source('../R/camel-calificacion-indicadores.R')
source('../R/camel-calificacion-entidad.R')
source('../R/camel-tendencia-indicadores.R')
source('../R/camel-render-table-datTrendInd.R')
```

<!-- DATOS -->
```{r}
datCamelIndNorm <- getDatCamelIndNorm(gestionInc = 2014)
datIdsNamesCamelInds <- getDatIdsNamesCamelInds()
```

# Diagnóstico de las instituciones financieras del sistema financiero de Bolivia

La metodología a aplicar para realizar diagnóstico de las instituciones financieras del sistema financiero de Bolivia sera el denominado como CAMEL, que responde a la evaluación solidez financiera de las instituciones.

\newpage
## Calculo de indicadores 

### Capital

#### Coeficiente de adecuación patrimonial (CAP)

```{r}
id <- 'indCap_CAP'
datTrendInd <- getDatTrendInd(id, datCamelIndNorm)

nameIndById <- datIdsNamesCamelInds[datIdsNamesCamelInds$INDICADOR==id,'NOMBRES']
idsDecreasing <- datIdsNamesCamelInds[datIdsNamesCamelInds$INDICADOR==id,'DECRECIENTE']
nameEntBestTrend <- datTrendInd[order(datTrendInd$TENDENCIA, decreasing = idsDecreasing),][1,1]
trendBestEnt <- datTrendInd[order(datTrendInd$TENDENCIA,decreasing = idsDecreasing),][1,2]
```

```{r, out.width='100%', fig.cap=nameIndById}
plotIndCamel(id, datCamelIndNorm)
```

El sector del sistema financiero con la tendencia mas favorable en el `r tolower(nameIndById)` atravez del tiempo son los `r tolower(nameEntBestTrend)` con una tendencia de `r trendBestEnt`, es decir, que los `r tolower(nameEntBestTrend)` varían en `r trendBestEnt` por unidad de tiempo respecto al `r tolower(nameIndById)`.


```{r}
getTableTrendInd(datTrendInd, 
                 captionTable ='Tendencia del CAP por tipo de entidad',
                 idsDecreasing=idsDecreasing)
```



\newpage
#### Coeficiente de cobertura de cartera en mora (CCCM)

```{r}
id <- 'indCap_CCCM'
datTrendInd <- getDatTrendInd(id, datCamelIndNorm)

nameIndById <- datIdsNamesCamelInds[datIdsNamesCamelInds$INDICADOR==id,'NOMBRES']
idsDecreasing <- datIdsNamesCamelInds[datIdsNamesCamelInds$INDICADOR==id,'DECRECIENTE']
nameEntBestTrend <- datTrendInd[order(datTrendInd$TENDENCIA, decreasing = idsDecreasing),][1,1]
trendBestEnt <- datTrendInd[order(datTrendInd$TENDENCIA,decreasing = idsDecreasing),][1,2]
```

```{r, out.width='100%', fig.cap=nameIndById}
plotIndCamel(id, datCamelIndNorm)
```

El sector del sistema financiero con la tendencia mas favorable en el `r tolower(nameIndById)` atravez del tiempo son los `r tolower(nameEntBestTrend)` con una tendencia de `r trendBestEnt`, es decir, que los `r tolower(nameEntBestTrend)` varían en `r trendBestEnt` por unidad de tiempo respecto al `r tolower(nameIndById)`.

```{r}
getTableTrendInd(datTrendInd, 
                 captionTable ='Tendencia del CCCM por tipo de entidad',
                 idsDecreasing=idsDecreasing)
```

\newpage
#### Coeficiente acido de cobertura de cartera en mora (CACCM)

```{r}
id <- 'indCap_CACCM'
datTrendInd <- getDatTrendInd(id, datCamelIndNorm)

nameIndById <- datIdsNamesCamelInds[datIdsNamesCamelInds$INDICADOR==id,'NOMBRES']
idsDecreasing <- datIdsNamesCamelInds[datIdsNamesCamelInds$INDICADOR==id,'DECRECIENTE']
nameEntBestTrend <- datTrendInd[order(datTrendInd$TENDENCIA, decreasing = idsDecreasing),][1,1]
trendBestEnt <- datTrendInd[order(datTrendInd$TENDENCIA,decreasing = idsDecreasing),][1,2]
```

```{r, out.width='100%', fig.cap=nameIndById}
plotIndCamel(id, datCamelIndNorm)
```

El sector del sistema financiero con la tendencia mas favorable en el `r tolower(nameIndById)` atravez del tiempo son los `r tolower(nameEntBestTrend)` con una tendencia de `r trendBestEnt`, es decir, que los `r tolower(nameEntBestTrend)` varían en `r trendBestEnt` por unidad de tiempo respecto al `r tolower(nameIndById)`.

```{r}
getTableTrendInd(datTrendInd, 
                 captionTable ='Tendencia del CACCM por tipo de entidad',
                 idsDecreasing=idsDecreasing)
```

\newpage
#### Coeficiente de cobertura patrimonial (CCP)

```{r}
id <- 'indCap_CCP'
datTrendInd <- getDatTrendInd(id, datCamelIndNorm)

nameIndById <- datIdsNamesCamelInds[datIdsNamesCamelInds$INDICADOR==id,'NOMBRES']
idsDecreasing <- datIdsNamesCamelInds[datIdsNamesCamelInds$INDICADOR==id,'DECRECIENTE']
nameEntBestTrend <- datTrendInd[order(datTrendInd$TENDENCIA, decreasing = idsDecreasing),][1,1]
trendBestEnt <- datTrendInd[order(datTrendInd$TENDENCIA,decreasing = idsDecreasing),][1,2]
```

```{r, out.width='100%', fig.cap=nameIndById}
plotIndCamel(id, datCamelIndNorm)
```

El sector del sistema financiero con la tendencia mas favorable en el `r tolower(nameIndById)` atravez del tiempo son los `r tolower(nameEntBestTrend)` con una tendencia de `r trendBestEnt`, es decir, que los `r tolower(nameEntBestTrend)` varían en `r trendBestEnt` por unidad de tiempo respecto al `r tolower(nameIndById)`.

```{r}
getTableTrendInd(datTrendInd, 
                 captionTable ='Tendencia del CCP por tipo de entidad',
                 idsDecreasing=idsDecreasing)
```

\newpage
### Activo

#### Coeficiente de exposición de cartera (CEC)

```{r}
id <- 'indAct_CEC'
datTrendInd <- getDatTrendInd(id, datCamelIndNorm)

nameIndById <- datIdsNamesCamelInds[datIdsNamesCamelInds$INDICADOR==id,'NOMBRES']
idsDecreasing <- datIdsNamesCamelInds[datIdsNamesCamelInds$INDICADOR==id,'DECRECIENTE']
nameEntBestTrend <- datTrendInd[order(datTrendInd$TENDENCIA, decreasing = idsDecreasing),][1,1]
trendBestEnt <- datTrendInd[order(datTrendInd$TENDENCIA,decreasing = idsDecreasing),][1,2]
```

```{r, out.width='100%', fig.cap=nameIndById}
plotIndCamel(id, datCamelIndNorm)
```

El sector del sistema financiero con la tendencia mas favorable en el `r tolower(nameIndById)` atravez del tiempo son los `r tolower(nameEntBestTrend)` con una tendencia de `r trendBestEnt`, es decir, que los `r tolower(nameEntBestTrend)` varían en `r trendBestEnt` por unidad de tiempo respecto al `r tolower(nameIndById)`.

```{r}
getTableTrendInd(datTrendInd, 
                 captionTable ='Tendencia del CEC por tipo de entidad',
                 idsDecreasing=idsDecreasing)
```

\newpage
#### Coeficiente de previsión de cartera (CPC)

```{r}
id <- 'indAct_CPC'
datTrendInd <- getDatTrendInd(id, datCamelIndNorm)

nameIndById <- datIdsNamesCamelInds[datIdsNamesCamelInds$INDICADOR==id,'NOMBRES']
idsDecreasing <- datIdsNamesCamelInds[datIdsNamesCamelInds$INDICADOR==id,'DECRECIENTE']
nameEntBestTrend <- datTrendInd[order(datTrendInd$TENDENCIA, decreasing = idsDecreasing),][1,1]
trendBestEnt <- datTrendInd[order(datTrendInd$TENDENCIA,decreasing = idsDecreasing),][1,2]
```

```{r, out.width='100%', fig.cap=nameIndById}
plotIndCamel(id, datCamelIndNorm)
```

El sector del sistema financiero con la tendencia mas favorable en el `r tolower(nameIndById)` atravez del tiempo son los `r tolower(nameEntBestTrend)` con una tendencia de `r trendBestEnt`, es decir, que los `r tolower(nameEntBestTrend)` varían en `r trendBestEnt` por unidad de tiempo respecto al `r tolower(nameIndById)`.

```{r}
getTableTrendInd(datTrendInd, 
                 captionTable ='Tendencia del CPC por tipo de entidad',
                 idsDecreasing=idsDecreasing)
```

\newpage
#### Coeficiente de previsión de cartera en mora (CPCM)

```{r}
id <- 'indAct_CPCM'
datTrendInd <- getDatTrendInd(id, datCamelIndNorm)

nameIndById <- datIdsNamesCamelInds[datIdsNamesCamelInds$INDICADOR==id,'NOMBRES']
idsDecreasing <- datIdsNamesCamelInds[datIdsNamesCamelInds$INDICADOR==id,'DECRECIENTE']
nameEntBestTrend <- datTrendInd[order(datTrendInd$TENDENCIA, decreasing = idsDecreasing),][1,1]
trendBestEnt <- datTrendInd[order(datTrendInd$TENDENCIA,decreasing = idsDecreasing),][1,2]
```

```{r, out.width='100%', fig.cap=nameIndById}
plotIndCamel(id, datCamelIndNorm)
```

El sector del sistema financiero con la tendencia mas favorable en el `r tolower(nameIndById)` atravez del tiempo son los `r tolower(nameEntBestTrend)` con una tendencia de `r trendBestEnt`, es decir, que los `r tolower(nameEntBestTrend)` varían en `r trendBestEnt` por unidad de tiempo respecto al `r tolower(nameIndById)`.

```{r}
getTableTrendInd(datTrendInd, 
                 captionTable ='Tendencia del CPCM por tipo de entidad',
                 idsDecreasing=idsDecreasing)
```

\newpage
#### Coeficiente de reposición de cartera (CRC)

```{r}
id <- 'indAct_CRC'
datTrendInd <- getDatTrendInd(id, datCamelIndNorm)

nameIndById <- datIdsNamesCamelInds[datIdsNamesCamelInds$INDICADOR==id,'NOMBRES']
idsDecreasing <- datIdsNamesCamelInds[datIdsNamesCamelInds$INDICADOR==id,'DECRECIENTE']
nameEntBestTrend <- datTrendInd[order(datTrendInd$TENDENCIA, decreasing = idsDecreasing),][1,1]
trendBestEnt <- datTrendInd[order(datTrendInd$TENDENCIA,decreasing = idsDecreasing),][1,2]
```

```{r, out.width='100%', fig.cap=nameIndById}
plotIndCamel(id, datCamelIndNorm)
```

El sector del sistema financiero con la tendencia mas favorable en el `r tolower(nameIndById)` atravez del tiempo son los `r tolower(nameEntBestTrend)` con una tendencia de `r trendBestEnt`, es decir, que los `r tolower(nameEntBestTrend)` varían en `r trendBestEnt` por unidad de tiempo respecto al `r tolower(nameIndById)`.

```{r}
getTableTrendInd(datTrendInd, 
                 captionTable ='Tendencia del CRC por tipo de entidad',
                 idsDecreasing=idsDecreasing)
```


\newpage
### Administración

#### Coeficiente de cobertura gastos administrativos (CCGA)

```{r}
id <- 'indAdm_CCGA'
datTrendInd <- getDatTrendInd(id, datCamelIndNorm)

nameIndById <- datIdsNamesCamelInds[datIdsNamesCamelInds$INDICADOR==id,'NOMBRES']
idsDecreasing <- datIdsNamesCamelInds[datIdsNamesCamelInds$INDICADOR==id,'DECRECIENTE']
nameEntBestTrend <- datTrendInd[order(datTrendInd$TENDENCIA, decreasing = idsDecreasing),][1,1]
trendBestEnt <- datTrendInd[order(datTrendInd$TENDENCIA,decreasing = idsDecreasing),][1,2]
```

```{r, out.width='100%', fig.cap=nameIndById}
plotIndCamel(id, datCamelIndNorm)
```

El sector del sistema financiero con la tendencia mas favorable en el `r tolower(nameIndById)` atravez del tiempo son los `r tolower(nameEntBestTrend)` con una tendencia de `r trendBestEnt`, es decir, que los `r tolower(nameEntBestTrend)` varían en `r trendBestEnt` por unidad de tiempo respecto al `r tolower(nameIndById)`.

```{r}
getTableTrendInd(datTrendInd, 
                 captionTable ='Tendencia del CCGA por tipo de entidad',
                 idsDecreasing=idsDecreasing)
```

\newpage
#### Coeficiente acido de cobertura gastos administrativos (CACGA)

```{r}
id <- 'indAdm_CACGA'
datTrendInd <- getDatTrendInd(id, datCamelIndNorm)

nameIndById <- datIdsNamesCamelInds[datIdsNamesCamelInds$INDICADOR==id,'NOMBRES']
idsDecreasing <- datIdsNamesCamelInds[datIdsNamesCamelInds$INDICADOR==id,'DECRECIENTE']
nameEntBestTrend <- datTrendInd[order(datTrendInd$TENDENCIA, decreasing = idsDecreasing),][1,1]
trendBestEnt <- datTrendInd[order(datTrendInd$TENDENCIA,decreasing = idsDecreasing),][1,2]
```

```{r, out.width='100%', fig.cap=nameIndById}
plotIndCamel(id, datCamelIndNorm)
```

El sector del sistema financiero con la tendencia mas favorable en el `r tolower(nameIndById)` atravez del tiempo son los `r tolower(nameEntBestTrend)` con una tendencia de `r trendBestEnt`, es decir, que los `r tolower(nameEntBestTrend)` varían en `r trendBestEnt` por unidad de tiempo respecto al `r tolower(nameIndById)`.

```{r}
getTableTrendInd(datTrendInd, 
                 captionTable ='Tendencia del CACGA por tipo de entidad',
                 idsDecreasing=idsDecreasing)
```

\newpage
### Beneficios

#### Coeficiente de rendimiento sobre activos (ROA)

```{r}
id <- 'indBenf_ROA'
datTrendInd <- getDatTrendInd(id, datCamelIndNorm)

nameIndById <- datIdsNamesCamelInds[datIdsNamesCamelInds$INDICADOR==id,'NOMBRES']
idsDecreasing <- datIdsNamesCamelInds[datIdsNamesCamelInds$INDICADOR==id,'DECRECIENTE']
nameEntBestTrend <- datTrendInd[order(datTrendInd$TENDENCIA, decreasing = idsDecreasing),][1,1]
trendBestEnt <- datTrendInd[order(datTrendInd$TENDENCIA,decreasing = idsDecreasing),][1,2]
```

```{r, out.width='100%', fig.cap=nameIndById}
plotIndCamel(id, datCamelIndNorm)
```

El sector del sistema financiero con la tendencia mas favorable en el `r tolower(nameIndById)` atravez del tiempo son los `r tolower(nameEntBestTrend)` con una tendencia de `r trendBestEnt`, es decir, que los `r tolower(nameEntBestTrend)` varían en `r trendBestEnt` por unidad de tiempo respecto al `r tolower(nameIndById)`.

```{r}
getTableTrendInd(datTrendInd, 
                 captionTable ='Tendencia del ROA por tipo de entidad',
                 idsDecreasing=idsDecreasing)
```

\newpage
#### Coeficiente de rendimiento sobre patrimonio (ROE)

```{r}
id <- 'indBenf_ROE'
datTrendInd <- getDatTrendInd(id, datCamelIndNorm)

nameIndById <- datIdsNamesCamelInds[datIdsNamesCamelInds$INDICADOR==id,'NOMBRES']
idsDecreasing <- datIdsNamesCamelInds[datIdsNamesCamelInds$INDICADOR==id,'DECRECIENTE']
nameEntBestTrend <- datTrendInd[order(datTrendInd$TENDENCIA, decreasing = idsDecreasing),][1,1]
trendBestEnt <- datTrendInd[order(datTrendInd$TENDENCIA,decreasing = idsDecreasing),][1,2]
```

```{r, out.width='100%', fig.cap=nameIndById}
plotIndCamel(id, datCamelIndNorm)
```

El sector del sistema financiero con la tendencia mas favorable en el `r tolower(nameIndById)` atravez del tiempo son los `r tolower(nameEntBestTrend)` con una tendencia de `r trendBestEnt`, es decir, que los `r tolower(nameEntBestTrend)` varían en `r trendBestEnt` por unidad de tiempo respecto al `r tolower(nameIndById)`.

```{r}
getTableTrendInd(datTrendInd, 
                 captionTable ='Tendencia del ROE por tipo de entidad',
                 idsDecreasing=idsDecreasing)
```

\newpage
### Liquidez

####  Coeficiente de capacidad de pago frente a pasivos (CCPP)

```{r}
id <- 'indLq_CCPP'
datTrendInd <- getDatTrendInd(id, datCamelIndNorm)

nameIndById <- datIdsNamesCamelInds[datIdsNamesCamelInds$INDICADOR==id,'NOMBRES']
idsDecreasing <- datIdsNamesCamelInds[datIdsNamesCamelInds$INDICADOR==id,'DECRECIENTE']
nameEntBestTrend <- datTrendInd[order(datTrendInd$TENDENCIA, decreasing = idsDecreasing),][1,1]
trendBestEnt <- datTrendInd[order(datTrendInd$TENDENCIA,decreasing = idsDecreasing),][1,2]
```

```{r, out.width='100%', fig.cap=nameIndById}
plotIndCamel(id, datCamelIndNorm)
```

El sector del sistema financiero con la tendencia mas favorable en el `r tolower(nameIndById)` atravez del tiempo son los `r tolower(nameEntBestTrend)` con una tendencia de `r trendBestEnt`, es decir, que los `r tolower(nameEntBestTrend)` varían en `r trendBestEnt` por unidad de tiempo respecto al `r tolower(nameIndById)`.

```{r}
getTableTrendInd(datTrendInd, 
                 captionTable ='Tendencia del CCPP por tipo de entidad',
                 idsDecreasing=idsDecreasing)
```

\newpage
#### Coeficiente acido de capacidad de pago frente a pasivos (CACPP)

```{r}
id <- 'indLq_CACPP'
datTrendInd <- getDatTrendInd(id, datCamelIndNorm)

nameIndById <- datIdsNamesCamelInds[datIdsNamesCamelInds$INDICADOR==id,'NOMBRES']
idsDecreasing <- datIdsNamesCamelInds[datIdsNamesCamelInds$INDICADOR==id,'DECRECIENTE']
nameEntBestTrend <- datTrendInd[order(datTrendInd$TENDENCIA, decreasing = idsDecreasing),][1,1]
trendBestEnt <- datTrendInd[order(datTrendInd$TENDENCIA,decreasing = idsDecreasing),][1,2]
```

```{r, out.width='100%', fig.cap=nameIndById}
plotIndCamel(id, datCamelIndNorm)
```

El sector del sistema financiero con la tendencia mas favorable en el `r tolower(nameIndById)` atravez del tiempo son los `r tolower(nameEntBestTrend)` con una tendencia de `r trendBestEnt`, es decir, que los `r tolower(nameEntBestTrend)` varían en `r trendBestEnt` por unidad de tiempo respecto al `r tolower(nameIndById)`.

```{r}
getTableTrendInd(datTrendInd, 
                 captionTable ='Tendencia del CACPP por tipo de entidad',
                 idsDecreasing=idsDecreasing)
```

\newpage
## Definición de rangos y limites de los indicadores

```{r}
datCamelRangosLimites <- getDatCamelRangosLimites(datCamelIndNorm)
```

```{r}
getTableCamelRangosLimites(datCamelRangosLimites)
```


## Definición de la ponderación de elementos CAMEL

$$CAMEL = \text{30\%C + 20\%A + 10\%M + 15\%E + 15\%L}$$

\newpage
## Calificación CAMEL

```{r}
datCamelCalificacionIndicadores <- getDatCamelCalificacionIndicadores(datCamelIndNorm,
                                                                      datCamelRangosLimites)

datCamelCalificacionEntidad <- getDatCamelCalificacionEntidad(datCamelCalificacionIndicadores)
```

```{r, out.width='100%', fig.cap='Resultados CAMEL'}
plotIndCamel("CAMEL",datCamelCalificacionEntidad)
```

```{r}
id <- 'CAMEL'
datTrendInd <- getDatTrendInd(id, datCamelCalificacionEntidad)
getTableTrendInd(datTrendInd, 
                 captionTable ='Tendencia CAMEL' )
```



