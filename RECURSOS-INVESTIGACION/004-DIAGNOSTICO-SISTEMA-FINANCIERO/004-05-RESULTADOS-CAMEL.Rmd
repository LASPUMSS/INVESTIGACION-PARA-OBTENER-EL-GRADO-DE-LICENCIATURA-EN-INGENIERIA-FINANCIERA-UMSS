---
output: pdf_document
tables: true
---

```{r}
source('RECURSOS-INVESTIGACION/R/camel-getCamelIndNormalizada.R')
source('RECURSOS-INVESTIGACION/R/camel-get-limites-rangos.R')
source("RECURSOS-INVESTIGACION/R/camel-get-tabla-referencia-calificaciones.R")

source('RECURSOS-INVESTIGACION/R/camel-calificacion-indicadores.R')
source('RECURSOS-INVESTIGACION/R/camel-calificacion-entidad.R')
source('RECURSOS-INVESTIGACION/R/camel-tendencia-stats-overview.R')

source('RECURSOS-INVESTIGACION/R/camel-plot-functions.R')
source("RECURSOS-INVESTIGACION/R/render-table-basic.R")

require(stringr)

if (!('dat' %in% ls())) {dat <- NULL}

datCamelIndNorm <- getDatCamelIndNormalizada(gestionInc=2014,by='TIPO_DE_ENTIDAD',dat=dat)
datCamelRangosLimites <- getDatCamelRangosLimites(datCamelIndNorm)

datCamelCalificacionIndicadores <- 
    getDatCamelCalificacionIndicadores(datCamelIndNorm,datCamelRangosLimites)

datCamelCalificacionEntidadSinPoderar <- 
    getDatCamelCalificacionEntidad(datCamelCalificacionIndicadores, FALSE)

datCamelCalificacionEntidad <- 
    getDatCamelCalificacionEntidad(datCamelCalificacionIndicadores)

tableRefenceCamelCalificaciones <- getTableRefenceCamelCalificaciones()

```

## Resultados CAMEL del sistema financiero

### Resultados indicadores de capital (C - CAMEL)

```{r}
id <- 'C'
datTrendInd <- getDatTrendStatsOverviewInd(id, datCamelCalificacionEntidadSinPoderar,TRUE ,FALSE)
```


```{r, out.width='100%', fig.cap='Resultado indicadores de Capital'}
plotIndCamel(id,datCamelCalificacionEntidadSinPoderar)
```

```{r}
renderTableBasic(datTrendInd,captionTable = 'Tendencia y estadisticas de indicadores de capital (CAMEL)',fontSize = 6.5)
```


\newpage
### Resultados indicadores de activos (A - CAMEL)

```{r}
id <- 'A'
datTrendInd <- getDatTrendStatsOverviewInd(id, datCamelCalificacionEntidadSinPoderar,TRUE ,FALSE)
```

```{r, out.width='100%', fig.cap='Resultado indicadores de activos'}
plotIndCamel(id,datCamelCalificacionEntidadSinPoderar)
```

```{r}
renderTableBasic(datTrendInd,captionTable = 'Tendencia y estadisticas de indicadores de activos (CAMEL)',fontSize = 6.5)
```



\newpage
### Resultados indicadores de administración (M - CAMEL)

```{r}
id <- 'M'
datTrendInd <- getDatTrendStatsOverviewInd(id, datCamelCalificacionEntidadSinPoderar,TRUE ,FALSE)
```

```{r, out.width='100%', fig.cap='Resultado indicadores de administración'}
plotIndCamel(id,datCamelCalificacionEntidadSinPoderar)
```

```{r}
renderTableBasic(datTrendInd,captionTable = 'Tendencia y estadisticas de indicadores de administración (CAMEL)',fontSize = 6.5)
```



\newpage
### Resultados indicadores de beneficios (E - CAMEL)

```{r}
id <- 'E'
datTrendInd <- getDatTrendStatsOverviewInd(id, datCamelCalificacionEntidadSinPoderar,TRUE ,FALSE)
```

```{r, out.width='100%', fig.cap='Resultado indicadores de beneficios'}
plotIndCamel(id,datCamelCalificacionEntidadSinPoderar)
```

```{r}
renderTableBasic(datTrendInd,captionTable = 'Tendencia y estadisticas de indicadores de beneficios o rendimiento (CAMEL)',fontSize = 6.5)
```



\newpage
### Resultados indicadores de liquidez (L - CAMEL)

```{r}
id <- 'L'
datTrendInd <- getDatTrendStatsOverviewInd(id, datCamelCalificacionEntidadSinPoderar,TRUE ,FALSE)
```

```{r, out.width='100%', fig.cap='Resultado indicadores de liquidez'}
plotIndCamel(id,datCamelCalificacionEntidadSinPoderar)
```

```{r}
renderTableBasic(datTrendInd,captionTable = 'Tendencia y estadisticas de indicadores de liquidez (CAMEL)',fontSize = 6.5)
```



\newpage
### Calificación CAMEL

```{r}
id <- 'CAMEL'
datTrendInd <- getDatTrendStatsOverviewInd(id, datCamelCalificacionEntidad,TRUE ,FALSE)

nameEntBestPromedio <- datTrendInd[1,1]
trendBestPromedio <- datTrendInd[1,3]

nameWorstTrend <- 
    datTrendInd %>% 
    arrange(desc(TENDENCIA)) %>% 
    select(TIPO_DE_ENTIDAD) %>% 
    slice(1) %>% 
    pull()

calificacionCamelDescrpcion <- 
    tableRefenceCamelCalificaciones %>% 
    filter(RAITING==as.character(trendBestPromedio)) %>% 
    select(DESCRIPCION) %>% pull()
calificacionCamelSignificado <- 
    tableRefenceCamelCalificaciones %>% 
    filter(RAITING==as.character(trendBestPromedio)) %>% 
    select(SIGNIFICADO) %>% pull()

```

```{r, out.width='100%', fig.cap='Calificación CAMEL'}
plotIndCamel(id,datCamelCalificacionEntidad)
```

El promedio mas favorable CAMEL a través del tiempo esta dado en el sector de `r str_to_lower(nameEntBestPromedio)` con un promedio de `r format(trendBestPromedio, scientific=FALSE)` siguiendo el criterio de calificación CAMEL el sector de `r str_to_lower(nameEntBestPromedio)` tiene una solidez financiera `r str_to_lower(calificacionCamelDescrpcion)` lo que quiere decir el sector es `r str_to_lower(calificacionCamelDescrpcion)`, si bien existe otros sectores con un mismo promedio histórico estos mismos poseen mayor desviación estándar lo que en consecuencia involucra mayor riesgo en su respectiva solidez financiera.

Otro punto a resaltar es que la tendencia en las series de tiempo CAMEL para los diferentes sectores financieros son positivos lo cual indica que la insolidez financiera va creciendo a través del tiempo siendo el sector de `r str_to_lower(nameWorstTrend)` los mas afectadas.


```{r}
renderTableBasic(datTrendInd,captionTable = 'Tendencia y estadisticas de CAMEL por tipo de entidad',fontSize = 6.5)
```



