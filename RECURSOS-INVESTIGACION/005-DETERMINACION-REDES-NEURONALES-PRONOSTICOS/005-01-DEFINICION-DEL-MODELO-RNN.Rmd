---
output: pdf_document
---

```{r}
source('RECURSOS-INVESTIGACION/R/get-dat-basic-normalizada.R')
source('RECURSOS-INVESTIGACION/R/pef-r2-ids-eeff-forecast.R')
source('RECURSOS-INVESTIGACION/R/pef-list-summary-resumen.R')
source('RECURSOS-INVESTIGACION/R/pef-get-dats-for-forescat.R')
source('RECURSOS-INVESTIGACION/R/pef-get-ids-for-models.R')
source("RECURSOS-INVESTIGACION/R/pef-get-camel-test.R")
source("RECURSOS-INVESTIGACION/R/render-table-basic.R")

require(kableExtra)
require(patchwork)
require(ggplot2)
require(scales)
require(dplyr)
require(fpp2)

if (!('listResultPEF' %in% ls())) {
    
    datTotalSistema <- getDatEEFFNormalizada(by = 'TOTAL_SISTEMA')
    
    ids <- getVariablesForModelsForecast()
    
    listResultPEF <- getListFittedAndSimulateModels(datTotalSistema,ids)
    listResumeModels <- getListResumeSummaryModels(listResultPEF)
    listDatsForTestCamels <- getDatsForTestCamels(listResultPEF,datTotalSistema,12,TRUE)
    
    
    originalCamelTest <- getCamelTestForecast(listDatsForTestCamels$datCuentas)
    nnCamelTest <- getCamelTestForecast(listDatsForTestCamels$nnDataForecastCuentas)
    mcoCamelTest <- getCamelTestForecast(listDatsForTestCamels$mcoDataForecastCuentas)
    arimaCamelTest <- getCamelTestForecast(listDatsForTestCamels$arimaDataForecastCuentas)
    
    camelTestModels <- bind_rows(originalCamelTest,
                                 nnCamelTest,
                                 mcoCamelTest,
                                 arimaCamelTest)
    
    id <- 'EERR_S2_RESULTADO_NETO_DE_LA_GESTION'
    
    trendCamelRNN <- readRDS(file ='FUENTES-DE-DATOS/DATA/trendCamelRNN.rds')
}

```

## Presiciones de los pronosticos de estados financieros

Los pronósticos realizados en el presente capítulo estarán sujetos a las especificaciones dadas a continuación.

### Series de tiempo

Los datos ha ser modelados están definidos por series de tiempo (cada serie de tiempo representa una cuenta de los estados financieros) de `r nrow(datTotalSistema)` observaciones cada una, las cuales agrupan a todas las entidades del sistema financiero de Bolivia, presentadas en el capitulo anterior.

Así también los datos se dividen en dos grupos:

- Datos de entrenamiento.
- Datos para realizar pruebas.

Donde los datos de entrenamiento serán utilizados para entrenar los modelos y los datos de pruebas para contrastar el ajuste de los pronósticos de los modelos respecto a la misma.

```{r, fig.height = 10, fig.width = 20, fig.cap='Agrupamiento de los datos de las series de tiempo.'}
autoplot(listResultPEF[[id]]$tsDatTrain,series = 'Datos de entrenamiento') +
    autolayer(listResultPEF[[id]]$tsDatTest,series = 'Datos para realizar pruebas') +
    ylab('RESULTADO NETO DE LA GESTION') +
    xlab('TIEMPO') +
    guides(color=guide_legend(ncol=2, title="")) +
    theme(legend.position="bottom",
          legend.text = element_text(size=24),
          legend.key.size = unit(2, 'cm'),
          axis.title.x=element_text(size=24), 
          axis.title.y = element_text(size=30),
          axis.text.y=element_text(size=24),
          axis.text.x = element_text(size=24))
    
```

### Modelos 

Los modelo empleados para las proyecciones son los siguientes:

- Redes neuronales artificiales (RNA)
- Minimos cuadrados ordinarios (MCO) 
- ARIMA

#### Arquitectura de redes neuronales

#### Arquitectura de MCO

$$ \text{Serie De Tiempo} = \text{ Tendencia + Estacionalidad} $$

#### Arquitectura ARIMA

### Evaluación de modelos

- R2 sobre datos ajustados
- R2 sobre datos proyectados

### Variables comprendidas

- Activo
- Pasivo
- Patrimonio
- Ingresos



