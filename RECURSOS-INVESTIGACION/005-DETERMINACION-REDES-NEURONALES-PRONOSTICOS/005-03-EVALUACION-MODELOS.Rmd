---
output: pdf_document
---

```{r}
source('RECURSOS-INVESTIGACION/R/get-dat-basic-normalizada.R')
source('RECURSOS-INVESTIGACION/R/pef-r2-ids-eeff-forecast.R')
source('RECURSOS-INVESTIGACION/R/pef-list-summary-resumen.R')
source('RECURSOS-INVESTIGACION/R/pef-get-dats-for-forescat.R')
source('RECURSOS-INVESTIGACION/R/pef-get-ids-for-models.R')
source("RECURSOS-INVESTIGACION/R/pef-get-camel-test.R")
source("RECURSOS-INVESTIGACION/R/render-table-basic.R")

require(kableExtra)
require(patchwork)
require(ggplot2)
require(dplyr)
require(fpp2)

if (!('listResultPEF' %in% ls())) {
    
    datTotalSistema <- getDatEEFFNormalizada(by = 'TOTAL_SISTEMA')
    
    ids <- getVariablesForModelsForecast()
    
    listResultPEF <- getListFittedAndSimulateModels(datTotalSistema,ids)
    listResumeModels <- getListResumeSummaryModels(listResultPEF)
    listDatsForTestCamels <- getDatsForTestCamels(listResultPEF,datTotalSistema,12,TRUE)
    
    
    originalCamelTest <- getCamelTestForecast(listDatsForTestCamels$datCuentas)
    nnCamelTest <- getCamelTestForecast(listDatsForTestCamels$nnDataForecastCuentas)
    mcoCamelTest <- getCamelTestForecast(listDatsForTestCamels$mcoDataForecastCuentas)
    arimaCamelTest <- getCamelTestForecast(listDatsForTestCamels$arimaDataForecastCuentas)
    
    camelTestModels <- bind_rows(originalCamelTest,
                                 nnCamelTest,
                                 mcoCamelTest,
                                 arimaCamelTest)
    
    id <- 'EERR_S2_RESULTADO_NETO_DE_LA_GESTION'
    
    trendCamelRNN <- readRDS(file ='FUENTES-DE-DATOS/DATA/trendCamelRNN.rds')
}

```


## Evaluaci贸n de datos ajustados de modelos

En esta secci贸n se calcula el nivel de ajuste de los modelos para las distintas series de tiempo observadas.

```{r}
renderTableBasic(listResumeModels$r2ModelsResum, 
                 captionTable = 'Ajuste R2 por cuenta',
                 fontSize = 6)
```

Donde el ajuste promedio por modelo se tiene los siguiente:

```{r}
renderTableBasic(listResumeModels$r2ModelsResumMean, 
                 captionTable = 'Ajuste R2 por modelo',
                 fontSize = 6)
```


## Evaluaci贸n de datos proyectados de modelos

En esta secci贸n se calcula el nivel de ajuste de las proyecciones de los modelos para las distintas series de tiempo observadas.

```{r}
renderTableBasic(listResumeModels$r2ForecastResum, 
                 captionTable = 'Ajuste R2 de proyecciones por cuenta',
                 fontSize = 6)
```

Donde el ajuste promedio de las proyecciones por modelo se tiene los siguiente:

```{r}
renderTableBasic(listResumeModels$r2ForecastResumMean,
                 captionTable = 'Ajuste R2 de proyecciones por modelo',
                 fontSize = 6)
```
