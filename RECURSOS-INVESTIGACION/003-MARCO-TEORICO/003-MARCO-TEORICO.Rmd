---
output: pdf_document
---

<!-- LIBRERIAS R NECESARIAS -->
```{r}
library(ggplot2)
library(dplyr)
library(patchwork)
library(knitr)
```

# Marco teorico

## Finanzas y el sistema financiero

Las finanzas se entiende como "la ciencia y arte de administrar el dinero" sujetas a restricciones dadas por un contexto que es dado por el sistema financiero, en decir, el sistema financiero, "consiste en diversas instituciones y mercados que sirven a las empresas de negocios, los individuos y los gobiernos".[@FAF]

Entonces se afirma que el sistema financiero en general está formado por el conjunto de instituciones publicas y privadas, constituidas en mercados, cuyo fin principal es canalizar el ahorro que generan los ahorradores hacia los prestatarios, así como facilitar y otorgar seguridad al movimiento de dinero y al sistema de pagos. 

### Entidades de intermediación financiera en Bolivia

Las definiciones presentadas a continuación están suscritas a la ley 393 - ley de servicios financieros.

#### Bancos múltiples.

Los bancos múltiples tendrán como objetivo la prestación de servicios financieros al publico en general, entendido como servicios financieros, aquellos servicios que tienen por objeto satisfacer las necesidades de las consumidoras y consumidores financieros.

#### Bancos PYME

Los bancos PYME son aquellos que tienen como objetivo la prestación de servicios financieros especializados en el sector de las pequeñas y medianas empresas, sin restricción para la prestación de los mismos también a la microempresa.


#### Entidades financieras de vivienda

Las entidades financieras de vivienda es una sociedad que tiene por objeto prestar servicios de intermediación financiera con especialización en prestamos para adquisición de vivienda, proyectos de construcción de vivienda unifamiliar o multifamiliar, compra de terrenos, refacción, remodelación, ampliación y mejoramiento de viviendas individuales o propiedad horizontal y otorgamiento de microcredito para vivienda familiar y para infraestructura de vivienda productiva, así tambien operaciones de arrendamiento financiero habitacional.

#### Cooperativas de ahorro y crédito abiertas

Las cooperativas de ahorro y crédito se constituyen como entidades especializadas de objeto único para la prestación de servicios de intermediación financiera, dirigidos a sus socios y al publico en general cunado corresponda.

#### Instituciones financieras de desarrollo

La institución financiera de desarrollo es una organización jurídica propia creada con el objeto de prestar servicios financieros con un enfoque integral que incluye gestión social.

#### Bancos de desarrollo productivo

El banco de desarrollo productivo es una institución con participación mayoritaria del estado que realiza actividades de primer y segundo piso de fomento y de promoción del desarrollo del sector productivo.

## Estados financieros

En el campo de la ciencia económicas los estados financieros tiene como objeto reflejar la situación económica-financiera de una institución.

En la página oficial de la Autoridad de Supervisión del Sistema Financiero (ASFI), "se define que los estados financieros constituyen una representación estructurada de la situación financiera y de las transacciones llevadas a cabo por la empresa. Su objetivo, con propósitos de información general, es suministrar información acerca de la situación y rendimiento financieros, así como de los flujos de efectivo que sea útil a una amplia variedad de usuarios al tomar sus decisiones económicas. Los estados financieros también muestran los resultados de la gestión que los administradores han efectuado con los recursos que se les han confiado". [@ASFI]

Entonces se afirma, que los estados financieros son un resumen del ejercicio económico de una empresa o institución, entendiendo al ejercicio económico como la suma de todas las actividades vinculadas al giro de la empresa en un intervalo de tiempo, dando información, sobre ingresos, egresos, pasivos, activos, es decir, los estados financieros son una fotografía de la empresa en un punto del tiempo.

### Balance general

El balance general se entiende como, "estado financiero que muestra, a una fecha determinada, el valor y la estructura del activo, pasivo y patrimonio de una empresa". [@ASFI] 

Con una expresión equivalente se afirma que el balance general representa una fotografía sobre  el estado de de los bienes y derechos, respecto a las obligaciones con  propietarios e terceros de la institución en un determinado momento.

### Estado de resultados

Estado de ganancias y pérdidas o estado de resultados, se entiende como, "documento contable que muestra el resultado de las operaciones (utilidad o pérdida) de una entidad durante un periodo y a una fecha determinada; resulta de la comparación de los ingresos con los gastos efectuados". [@ASFI]

Es decir, el estado de resultados muestra la conclusión en términos monetarios del conjunto de actividades administrativas y complementarias en un intervalo de tiempo de la institución correspondiente. 

## Evaluación financiera

La evaluación financiera se entiende como un proceso de valoración de los resultados de actividades económica-financieras de las instituciones.

### Indicadores financieros 

La teoría financiera indica que un indicador financiero tiene como objeto final medir una característica de la entidad estudiada, estos pueden ser los siguientes:

- Estructura de activos.
- Estructura de pasivos.
- Estructura de obligaciones.
- Calidad de cartera.
- Liquidez.
- Rentabilidad.
- Ingresos y gastos financieros.
- Eficacia administrativas.

Pero los indicadores financieros por si solos no pueden brindar información integrada sobre la situación económica-financiera de una institución en consecuencia a esta necesidad, se encuentra las metodologías de evaluación como ser la metodología CAMEL y PERLAS.


## Método CAMEL

La metodología CAMEL evalúa la **solidez financiera** de las instituciones con base ha indicadores cuantitativos, contemplando cinco características: 

- Capital adecuado (C).
- Calidad del activo (A).
- Capacidad de la gerencia (M).
- Rentabilidad (E).
- Situación de liquidez (L).

La **solidez financiera** de una institución debe entenderse como la capacidad que tiene dicha institución de hacer frente a las obligaciones que tiene con terceros y propietarios.

La presente metodología se divide en siguientes pasos:

- Calculo de indicadores que responden a los características antes mencionadas.
- Definición de rangos y limites de los indicadores.
- Definición de la ponderación, que responden a la solidez financiera de la institución.
- Calificación CAMEL.

Los mismos que se describen a continuación:

### Calculo de indicadores

#### Capital

##### Coeficiente De Adecuación Patrimonial

Está definido cómo la relación porcentual entre el capital regulatorio y los activos y contingentes ponderados en función de factores de riesgo, incluyendo a los riesgos de crédito, de mercado y operativo, utilizando los procedimientos establecidos en la normativa emitida por la Autoridad de Supervisión del Sistema Financiero - ASFI.

##### Coeficiente De Covertura De Cartera En Mora

Este indicador mide o tiene objeto responder si el patrimonio de la institución cubre en tanto por ciento:
- Los créditos cuyo capital, cuotas de amortización o intereses no hayan sido cancelados íntegramente a la entidad hasta los 30 días contados desde la fecha de vencimiento. 
- Los créditos por los cuales la entidad ha iniciado las acciones judiciales para el cobro.
- Descontando la previsión por incobrabilidad de créditos.

$$ \frac{ \text{Cartera En Mora - Previsión Cartera} }{\text{Patrimonio}}$$

##### Coeficiente Acido De Covertura De Cartera En Mora

Este indicador mide o tiene objeto responder si el patrimonio de la institución cubre en tanto por ciento:
- Los créditos cuyo capital, cuotas de amortización o intereses no hayan sido cancelados íntegramente a la entidad hasta los 30 días contados desde la fecha de vencimiento. 
- Los créditos por los cuales la entidad ha iniciado las acciones judiciales para el cobro.
- Descontando la previsión por incobrabilidad de créditos y adjuntando bienes realizables.

$$ \frac{ \text{Cartera De Mora - Previsión Carter + Realizables} }{ \text{Patrimonio} } $$

##### Coeficiente de cobertura patrimonial

Este indicador mide o tiene por objeto responder si los activos descontando los cuentas contingentes cubren los el patrimonio de la misma.

$$ \frac{ \text{Patrimonio} }{ \text{Activo - Contingente} } $$

#### Activo

##### Coeficiente de exposición de cartera

El presente coeficiente determina que por ciento de lo créditos están expuestos a riesgo de ser incumplidos o cancelados.

$$  \frac{ \text{Cartera En Mora} }{ \text{Cartera Bruta} } $$

##### Coeficiente de previsión de cartera

El presente coeficiente mide o tiene por objeto responder en que tanto por ciento esta cubierta los créditos realizados por la institución.

$$ \frac{ \text{Prevision} }{ \text{Cartera Bruta} } $$

##### Coeficiente de previsión de cartera en mora

Este coeficiente mide o tiene por objeto responder en que tanto por ciento esta cubierta los créditos incobrables realizados por la institución.

$$ \frac{ \text{Prevision} }{ \text{Cartera En Mora} } $$

##### Coeficiente de reposición de cartera

Dicho coeficiente tiene por objeto medir en que tanto por ciento alcanzan los créditos re programados.

$$ \frac{ \text{Cartera Reprogramada Total} }{ \text{Cartera Bruta} } $$

#### Administración

##### Coeficiente de cobertura gastos administrativos

El coeficiente mide si los activos de la institución pueden hacer frente a los gastos administrativos de la institución.

$$ \frac{ \text{Gastos Administración} }{ \text{Activos + Contingentes} } $$


##### Coeficiente acido de cobertura patrimonial

Este coeficiente mide si los ingresos brutos pueden hacer frente a los gastos administrativos de la institución.

$$ \frac{ \text{Gastos Administración - Impuestos} }{ \text{Resultado Operativo Bruto} } $$

#### Beneficios

##### Coeficiente de rendimiento sobre activos

El presente coeficiente determina el rendimiento en tanto por uno, los beneficios que han generado los activos.

$$ \frac{ \text{Resultado Neto De La Gestión} }{ \text{Activo+Contingente} } $$


##### Coeficiente de rendimiento sobre patrimonio

Este coeficiente determina el rendimiento en tanto por uno, los beneficios que ha generado el patrimonio.

$$ \frac{ \text{Resultado Neto De La Gestión} }{ \text{Patrimonio} } $$

#### Liquidez

##### Coeficiente de capacidad de pago frente obligaciones a corto plazo 

El coeficiente busca medir si la institución puede hacer frente a sus obligaciones con los activos disponibles y inversiones temporales.

$$ \frac{ \text{Disponibles + Inversiones Temporarias} }{ \text{Obligaciones A Corto Plazo} } $$

##### Coeficiente acido de capacidad de pago frente obligaciones a corto plazo

El coeficiente busca medir si la institución puede hacer frente a sus obligaciones con los activos disponibles.

$$ \frac{ \text{Disponibles} }{ \text{Obligaciones A Corto Plazo} } $$

### Definición de rangos y limites de los indicadores

En esta sección de la metodología CAMEL se establecen rangos a los cuales le corresponde una calificación, sujeta a una probabilidad, es decir, aquellos resultados mejores pero menos probable reciben una mejor calificación y aquellos resultados peores y menos probables reciben una peor calificación. 

\input{RECURSOS-INVESTIGACION/003-MARCO-TEORICO/tabla-ejemplo-tipo-calificacion-camel}

### Definición de la ponderación

$$CAMEL = \text{30\%C + 20\%A + 10\%M + 15\%E + 15\%L}$$

### Calificación CAMEL

Dado los pasos anteriores la metodología CAMEL asigna una puntuación a la institución, y permitirá determinar que institución le corresponde mayor solidez financiera respecto a las otras instituciones.


## Pronósticos

El termino de pronóstico de uso común, definido por la Real Academia Española (RAE) como la acción y efecto de pronosticar, la misma RAE define pronosticar como predecir algo en el futuro a partir de indicios. El pronóstico es el proceso de estimación en situaciones de incertidumbre, para los propósitos de esta investigación, un pronóstico es un evento asociado a una distribución de probabilidad.

En consecuencia los pronósticos por si solos tampoco pueden brindar información integrada sobre la situación económica-financiera futura de la institución, en consecuencia a esta necesidad, se encuentra las metodologías de evaluación junto con la simulación de procesos estocásticos.

<!-- #################################################################  -->
<!--                    REDES NEURONALES                                -->
<!-- #################################################################  -->

<!-- INTELIGENCIA ARTIFICIAL -->

## Inteligencia artificial

"En la literatura referente a la inteligencia artificial no existe consenso sobre lo que se entiende como inteligencia artificial, pero estas diferencias se engloban en dos ideas, donde la inteligencia artificial se refieren a procesos mentales y al razonamiento".[@IAUEM]

Ahora bien el campo de la inteligencia artificial es relativamente reciente, y cobra atención en la actualidad por su capacidad de resolver problemas que con anterioridad sus resultados se divisaban lejanos, como el pronóstico de fenómenos no lineales, procesamientos de lenguaje natural, generador de imágenes, clasificación de objetos e procesos estocásticos donde se encuentra la proyección de estados financieros. 

### Aprendizaje supervisado con redes neuronales

El aprendizaje supervisado corresponde a la situación en que se tiene una variable de salida, ya sea cuantitativa o cualitativa, que se desea predecir basándose en un conjunto de características.[@IALAT]

**El aprendizaje supervisado es una rama del aprendizaje automático, son algoritmos que permiten aprender a la red neuronal mediante datos ejemplos que están compuesta por un vector de entrada que son las variables independientes, y otro vector denomina etiquetas, donde la red se encarga de encontrar las relaciones existentes entre las variables independientes, realizando cambios y adaptando el modelo por medio de variaciones sujetas a una función de coste.** 

### Aprendizaje no supervisado con redes neuronales

El aprendizaje no supervisado, "corresponde a la situación en que existe un conjunto de datos que contienen diversas características de determinados individuos, sin que ninguna de ellas se considere una variable de salida que se desee predecir".[@IALAT]

Aprendizaje no supervisado es un método de aprendizaje automático donde la red neuronal se ajusta a las observaciones. Se distingue del aprendizaje supervisado por el hecho de que no hay un conocimiento a priori es decir etiquetas que sirvan como guía, en el aprendizaje no supervisado solo se cuenta con un conjunto de datos de objetos de entrada.

<!-- REDES NEURONALES ARTIFICIALES -->

## Redes neuronales artificiales

Las Redes Neuronales "son un paradigma de aprendizaje y procesamiento automático inspirado en la forma en que funciona el cerebro para realizar las tareas de pensar y tomar decisiones (sistema nervioso)".[@IALAT]

Una red neuronal es un método del aprendizaje automático que enseña a las computadoras a procesar datos de una manera que está inspirada en la forma en que lo hace el cerebro humano, las redes neuronales artificiales es modelo computacional resultado de diversas aportaciones científicas, consiste en un conjunto de unidades llamadas neuronas artificiales.

## Elementos de redes neuronales

Como todo sistema es el resultado de la interacción de elementos simples trabajando conjuntamente, que se presenta a continuación.

### Neurona artificial

La neurona es la unidad básica de procesamiento de una red neuronal de ahí el nombre, igual que su equivalente biológico una neurona artificial recibe estímulos externos y devuelve otro valor, esta es expresada matemáticamente como una función, donde la neurona realiza una suma ponderada con los datos de entrada.

Dado:

$$ X = \left( x_{1},x_{2},x_{3},...,x_{n} \right) $$
Se tiene:
$$ Y = f(X) = \sum_{i=1}^{n}{w_{i}x_{i}}  = \sum{WX}  $$
Donde:
\newline
X = Vector de los datos de entrada.
\newline
Y = Vector resultado de la suma ponderada.
\newline
W = Vector de los pesos las variables independientes.

La arquitectura de la red neuronal corresponde a la manera en que esta ordena las neuronas, si las neuronas son colocadas de forma vertical, reciben los mismos datos de entrada y sus resultados de salida lo pasan a la siguiente capa, la última capa de una red neuronal se denominan capa de salida y las capas que estén entre la capa de salida y capa de entrada se denominas capas ocultas. Ahora bien, al ser cada neurona una suma ponderada esta equivaldría a una sola capa de la red, a esto se denomina colisión de la red neuronal, para resolver este problema se planteó los que se conoce como función de activación que es una función no lineal que distorsiona los resultados salientes de cada neurona.

$$A = f(Y)$$

Dado lo anterior expuesto una capa de una red neuronal se debe entender como la agrupación neuronas.

### Funciones de activación

Las funciones de activación distorsionan de forma no lineal las salidas de las neuronas para así no colapsar la red, es decir, las funciones de activación permiten conectar capas neuronales, dentro las funciones de activación más conocidas se tiene:

#### Función escalon

Esta función asigna el valor de 1 si la salida de la neurona supera cierto umbral y cero si no lo supera.

$$ f(x) = max(0,x) = \left \{
\begin{array}{rcl}
     0 & Si & x < 0
  \\ 1 & Si & x \geq{0}
\end{array}
\right. $$

#### Función sigmoide

Esta función genera un en un rango de valores de salida que están entre cero y uno por lo que la salida es interpretada como una probabilidad. 

$$ f(x) = \frac{1}{1+e^{-x}}$$

#### Función tangente hiperbólica

Esta función de activación llamada tangente hiperbólica tiene un rango de valores de salida entre -1 y 1.

$$ f(x) = \frac{2}{1+e^{-2x}} - 1 $$

#### Función Relu

La función ReLU transforma los valores introducidos anulando los valores negativos y dejando los positivos.

$$ f(x) = max(0,x) = \left \{
\begin{array}{rcl}
     0 & Si & x < 0
  \\ x & Si & x \geq{0}
\end{array}
\right. $$

#### Función Leaky ReLU

La función Leaky ReLU transforma los valores introducidos multiplicando los negativos por un coeficiente rectificativo y dejando los positivos según entran.

$$ f(x) = max(0,x) = \left \{
\begin{array}{rcl}
     0 & Si & x < 0
  \\ a*x & Si & x \geq{0}
\end{array}
\right. $$

#### Función Softmax

La función Softmax transforma las salidas a una representación en forma de probabilidades, de tal manera que el sumatorio de todas las probabilidades de las salidas de 1.

$$ f(Z)_{j} = \frac{ e^{Z_{J}} }{ \sum_{k=1}^{K} e^{Z_{K}} } $$

<!-- Gráficos de funciones activación -->

```{r, fig.cap='Funciones de activación', out.height='70%', out.width='100%'}
######################################################
### Función de escalonada
######################################################

escalonada <- function(x) { ifelse(x<0,0,1) }

x <- seq(-6,6,0.1)
y <- escalonada(x)    

plotEscalonada <-  
    data.frame(x=x,y=y) %>% 
    ggplot(aes(x=x,y=y)) + 
    geom_line() + 
    xlab('X') + 
    ylab('Y') +
    ggtitle('Función escalonada')

######################################################
### Función de activación sigmoide
######################################################

sigmoide <- function(x) {(1)/(1+exp(-x))}
x <- seq(-6,6,0.1)
y <- sigmoide(x)    

plotSigmoide <- 
    data.frame(x=x,y=y) %>% 
    ggplot(aes(x=x,y=y)) + 
    geom_line() + 
    xlab('X') + 
    ylab('Y') + 
    ggtitle('Función sigmoide')


######################################################
### Función de activación tangente hiperbolica
######################################################

hiperbolica <- function(x) { (((2)/(1+exp(-2*x)))-1) }
x <- seq(-6,6,0.1)
y <- hiperbolica(x)    

plotHiperbolica <- 
    data.frame(x=x,y=y) %>% 
    ggplot(aes(x=x,y=y)) + 
    geom_line() + 
    xlab('X') + 
    ylab('Y') + 
    ggtitle('Función tangente hiperbolica')

######################################################
### Función de activación ReLU – Rectified Lineal Unit
######################################################

relu <- function(x) { ifelse(x<0,0,x) }

x <- seq(-6,6,0.1)
y <- relu(x)    

plotRelu <-  
    data.frame(x=x,y=y) %>% 
    ggplot(aes(x=x,y=y)) + 
    geom_line() + 
    xlab('X') + 
    ylab('Y') +
    ggtitle('Función ReLu')

######################################################
### Función de activación Leaky ReLU 
######################################################

leakyRelu <- function(x,a) { ifelse(x<0,0,x*a) }

x <- seq(-6,6,0.1)
y <- leakyRelu(x,0.01)    

plotLeakyRelu <-  
    data.frame(x=x,y=y) %>% 
    ggplot(aes(x=x,y=y)) + 
    geom_line() + 
    xlab('X') + 
    ylab('Y') +
    ggtitle('Función Leaky relu')

######################################################
### Función de activación Softmax
######################################################

softmax <- function(par){
    n.par <- length(par)
    par1 <- sort(par, decreasing = TRUE)
    Lk <- par1[1]
    for (k in 1:(n.par-1)) {
        Lk <- max(par1[k+1], Lk) + log1p(exp(-abs(par1[k+1] - Lk))) 
    }
    val <- exp(par - Lk)
    return(val)
}

x <- seq(-6,6,0.1)
y <- softmax(x)    

plotSoftmax <-  
    data.frame(x=x,y=y) %>% 
    ggplot(aes(x=x,y=y)) + 
    geom_line() + 
    xlab('X') + 
    ylab('Y') +
    ggtitle('Función Softmax')

######################################################
### GRAFICO UNIDO
######################################################
(plotEscalonada+plotSigmoide)/(plotHiperbolica+plotRelu)/(plotLeakyRelu +plotSoftmax)

```

\newpage
### Propagación hacia adelanate y hacia atras

#### Propagación hacia adelante

Para hacer manifiesto el algoritmo de propagación hacia adelante se supone que la estructura de red, estará compuesta de de cuatro capas, es decir, la capa de entrada y salida junto a dos capas neuronales ocultas, dada esta estructura el algoritmo tendrá el siguiente comportamiento:

- Capa de entrada esta definida por:

$$ x = a^{(1)}$$

- La primera capa oculta procesara los datos de la capa de entrada toma la siguiente forma:

$$ z^{(2)} = W^{(1)}x + b^{(1)} $$

- Antes de pasar los datos procesados en las neuronas de la primera capa oculta deben ser pasados por las funcioes de activación, para que no colapse la red: 

$$a^{(2)} = f(z^{(2)})$$

- Nuevamente se procesara los datos de la capa de anterior:

$$ z^{(3)} = W^{(2)}a^{(2)} + b^{(2)} $$

- Tambien nuevamente se envuelve los resultados en una función de activación antes de pasar a la capa de salida:

$$a^{(3)} = f(z^{(3)})$$

- Finalmente tendremos una salida, la cual sera evaluada si coincide con los datos esperados.

$$ s = W^{(3)}a^{(3)} $$

#### Propagación hacia atrás

El algoritmo de propagación hacia atrás o "backpropagation" tiene como objeto dotar de aprendizaje a las redes neuronales minimizando la función de costo ajustando los pesos y sesgos de la red, el nivel de ajuste está determinado por los gradientes para cada neurona hasta llegar a la capa de entrada.

Dada un función de costo:

$$ C = f(s,y) $$

Se calcula las derivadas parciales para cada neurona, para determinar que rutas que han generado menor error, hasta la capa de entrada:

$$ \frac{ \partial{C} }{ \partial{x} }$$

Para el logro de esta derivada se hace uso de un método matemático "Chain Rule".